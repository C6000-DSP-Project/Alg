// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
//
//      新核科技(广州)有限公司
//
//      Copyright (C) 2022 CoreKernel Technology Guangzhou Co., Ltd
//
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
//
//      有限长单位冲激响应滤波器
//
//      2022年04月26日
//
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
/*
 *    数字信号处理函数库
 *
 *    纯算法示例可以在软件仿真环境下测试(CCSv5 以上版本均不再支持软件仿真)
 *
 *    - 希望缄默(bin wang)
 *    - bin@corekernel.net
 *
 *    官网 corekernel.net/.org/.cn
 *    社区 fpga.net.cn
 *
 */
#include <stdio.h>

#include <math.h>

#include "mathlib.h"

#include "dsplib.h"

// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
//
//      宏定义
//
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// 软件断点
#define SW_BREAKPOINT     asm(" SWBP 0 ");

// 采样点数
#define N   1024

// 采样频率
#define Fs  1024.0

// 滤波器阶数
#define NH  32

// π 及 浮点数极小值
#define PI                3.14159
#define F_TOL             (1e-06)

// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
//
//      全局变量
//
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#pragma DATA_ALIGN(FIRIn, 8);
float FIRIn[N + (NH - 1)];

#pragma DATA_ALIGN(FIROut, 8);
float FIROut[N];

// 滤波器系数
// 通过 MATLAB 数字信号处理工具箱 Filter Design &  Analysis Tool 生成
#pragma DATA_ALIGN(h, 8);
float h[NH]=
{
   -5.061877164e-05, -9.336374205e-05,  0.0003678254143,   0.0005914540961, -0.001496405224,
   -0.002226336394,   0.004491201602,   0.006349918433,   -0.01111812051,   -0.01528073754,
    0.02449801192,    0.03380065784,   -0.0527959317,     -0.0793820098,     0.1454829872,
    0.4468590915,     0.4468590915,     0.1454829872,     -0.0793820098,    -0.0527959317,
    0.03380065784,    0.02449801192,   -0.01528073754,    -0.01111812051,    0.006349918433,
    0.004491201602,  -0.002226336394,  -0.001496405224,    0.0005914540961,  0.0003678254143,
   -9.336374205e-05, -5.061877164e-05
};

// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
//
//      主函数
//
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
int main()
{
    // 生成信号
    unsigned int i;
    for(i = 0; i < N; i++)
    {
        FIRIn[i + NH / 2] = 5 * sinsp(2 * PI * 100 * (i / Fs)) + 10 * sinsp(2 * PI * 450 * (i / Fs));
    }

    // FIR 滤波 低通(滤除 450Hz 信号)
    DSPF_sp_fir_r2(FIRIn, h, FIROut, NH, N);

    // 断点
    SW_BREAKPOINT;
}
